# **Chapter 1. 이더리움이란 무엇인가?**
> 본 글은 『Mastering Ethereum』을 읽고 정리한 내용입니다.

이더리움은 종종 `월드 컴퓨터(world computer)`라고 하는데, 그 의미는 무엇일까?

컴퓨터 과학의 관점에서 보자면 이더리움은 결정론적(deterministic)이지만, 사실상 한정되지 않은 상태 머신(unbounded state machine)이며, 이것은 전역적으로(globally) 접근 가능한 싱글톤(singleton) 상태와 그 상태를 변화시킬 수 있는 가상 머신으로 구성되어 있다.

좀 더 실용적인 관점에서 볼 때, 이더리움은 `스마트 컨트랙트(smart contract)`라는 프로그램을 실행하는 오픈 소스에 기반을 둔, 전 세계에 걸쳐 탈중앙화된 컴퓨팅 인프라스트럭처이다. 블록체인을 사용하여 시스템의 상태 변화를 동기화하고 저장하며, `이더(ether)`라고 하는 암호화폐를 이용하여 실행 자원 비용을 측정하고 제한한다.

개발자는 이더리움 플랫폼을 사용해서 경제적 기능들을 내장한 강력하면서도 탈중앙화된 애플리케이션을 개발할 수 있다. 그리고 이더리움 플랫폼은 고가용성, 감사 가능성, 투명성, 중립성을 제공하는 동시에 검열을 줄이거나 없애고, 거래상대방의 위험을 줄인다.

## **비트코인과의 비교**

공통점
* P2P 네트워크
* 비잔틴 결함 허용 합의 (Byzantine fault-tolerant consensus) 알고리즘(작업증명 블록체인)
* 디지털 서명과 해시
* 디지털 화폐(이더) 같은 암호학 기반 기술 사용

차이점
* 단순 디지털 화폐 지급 네트워크가 목적인 비트코인과 달리,
* 이더의 사용 목적은 월드 컴퓨터로서의 이더리움 플랫폼 사용료를 지불하기 위한 `유틸리티 화폐(utility currency)`이다.
* 매우 제한된 스크립트 언어를 사용하는 비트코인과 달리,
* 이더리움은 임의성과 무한 복잡성을 가진 코드를 실행할 수 있는 `가상 머신(virtual machine)`을 운영하는 범용 프로그래밍이 가능한 블록체인이다.
* 비트코인의 스크립트 언어가 의도적으로 지불 조건에 대한 단순한 참/거짓 평가에만 제한되어 있는 반면,
* 이더리움 언어는 `튜링완전(Turing complete)` 언어이다. (이더리움이 범용 컴퓨터로 직접 작동할 수 있음을 의미)

## **블록체인 구성요소**

공개 블록체인(public blockchain)의 구성요소는 일반적으로 다음과 같다.

* 표준화된 `가십(gossip)` 프로토콜을 기반으로 참여자를 연결하고 트랜잭션 및 검증된 트랜잭션 블록을 연결하는 peer-to-peer(P2P) 네트워크
* 상태 전이를 나타내는 트랜잭션 형식의 메시지
* 트랜잭션의 구성 요건과 트랜잭션의 유효성을 판단하는 합의 규칙의 집합
* 합의 규칙에 따라 트랜잭션을 처리하는 상태 머신
* 검증되고 적용된 모든 상태 전이의 장부(journal) 역할을 해줄 수 있는, 암호학적으로 보호된 체인(chain)
* 합의 규칙들을 적용하는 데 모든 참여자가 협력할 수 있도록 강제함으로써 블록체인의 통제 권한을 탈중앙화하는 합의 알고리즘
* 공개된 환경에서 상태 머신에 경제적인 보안성을 제공할 수 있는 게임 이론적으로 유효한 인센티브 메커니즘 (ex: 작업증명 비용 + 블록 보상)
* 위에서 언급된 것들을 구현한 하나 이상의 오픈 소스 소프트웨어 (clients)

일반적으로 이러한 구성요소의 전부 또는 대부분은 단일 소프트웨어 클라이언트로 통홥된다.

예를 들어, 비트코인에서 기준이 되는 구현제(reference implementation)는 `비트코인 코어(Bitcoin Core)` 오픈 소스 프로젝트가 개발하고, 이것은 `bitcoind`라는 클라이언트 소프트웨어로 개발된다.

이와 달리, 이더리움에서는 기준이 되는 구현제가 아닌 `기준 사양(reference specification`)을 사용하는데, 황서(Yellow Paper)에서 밝히고 있는 시스템의 수학적 기술이 바로 그것이다. 그래서 이더리움에는 기준 사양에 따라 만들어진 많은 클라이언트가 있다.

오늘날, 서로 다른 속성을 지닌 많은 종류의 블록체인이 존재하기 때문에 위의 구성요소들을 가지고 다음과 같은 블록체인의 핵심적인 특징들을 지니고 있는지 살펴보아야 한다.

블록체인의 핵심적인 특징
* 개방성 (open)
* 공공성 (public)
* 국제화 (global)
* 탈중앙화 (decentralized)
* 중립성 (neutral)
* 검열 저항성 (censorship-resistant) 등

## **이더리움의 탄생**

사람들이 비트코인 모델의 힘을 인식하고 암호화폐 애플리케이션을 넘어서려고 시도했던 당시 이더리움도 구상되기 시작됐다. 당시 개발자들은 비트코인 기반 위에 구축하거나, 아니면 새로운 블록체인을 시작해야하는 난제에 직면했다. 비트코인 기반 위에 구축한다는 건, 네트워크의 의도적인 제약 조건들을 전제한 상태에서 해결책을 찾아야 한다는 뜻이었다. 제한된 트랜잭션 타입, 제한된 애플리케이션 종류, 공개 블록체인을 사용하는 장점을 없애야하는 문제 등 많은 제약 사항과 수많은 작업을 필요로 했다.

2013년 말 비트코인 지지자 프로그래머인 비탈릭 부테린(Vitalik Buterin)은 튜링 완전한 범용 블록체인인 이더리움의 개념을 설명하는 화이트 페이퍼를 공유했고 수십 명의 사람이 이 초기 초안을 살펴보고 제안서를 발전시킬 수 있도록 의견을 제시했다. 그 중 게빈 우드(Dr. Gavin Wood) 박사는 비탈릭에게 먼저 연락하여 C++ 프로그래밍 기술을 도와주겠다고 제안했고 이후 이더리움의 공동 설립자이자 공동 설계자이자 CTO가 되었다.

2013년 12월부터 비탈릭과 개빈은 아이디어들을 개선하고 진화시켜 지금의 이더리움이 된 프로토콜 계층을 구축했다.

사토시(Satoshi)와 마찬가지로, 비탈릭과 개빈은 단시 새로운 기술을 발명한 것이 아니었다. 발명한 신기술과 기존 기술을 새로운 방식으로 결합했고, 그들의 아이디어를 세상에 증명하기 위해 프로토타입 코드를 배포했다.

창립자들은 수년간 비전을 구축하고 개선했다. 그리고 2015년 7월 30일, 첫 번째 이더리움 블록이 채굴되었다. 드디어 월드 컴퓨터가 세상에 서비스를 제공하기 시작한 것이다.

## **이더리움 개발의 4단계**

이더리움은 `프론티어(Frontier)`, `홈스테드(Homestead)`, `메트로폴리스(Metropolis)`, `세레니티(Serenity)` 이렇게 네 단계로 나누어 진행되었으며, 각 단계에는 이전 버전과 호환되지 않는 방식으로 기능을 변경하는 하드 포크(hard fork)라고 하는 하위 버전이 포함될 수 있다.

**블록 #0**

* `프론티어(Frontier)` : 2015년 7월 30일부터 2016년 3월까지 지속된 이더리움 초기 단계

**블록 #200,000**

* `아이스 에이지(Ice Age)` : 기하급수적으로 증가하는 난의도 증가를 도입하여 지분증명(PoS)으로 전환하도록 동기를 부여하는 하드 포크

**블록 #1,150,000**

* `홈스테드(Homestead)` : 2016년 3월에 시작된 이더리움의 두 번째 단계

**블록 #1,192,000**

* `DAO` : 해킹된 DAO 컨트랙트의 피해자에게 보상금을 지급하고 이더리움 및 이더리움 클래식을 2개의 경쟁 시스템으로 분할하는 하드 포크

**블록 #2,463,000**

* `탠저린 휘슬(Tangerine Whistle)` : 특정 I/O가 많은 작업에 대한 가스 계산을 변경하고, 해당 작업의 가스 비용이 낮은 서비스를 거부(Denial-of-Service, DoS) 공격으로부터 축적된 상태를 지우는 하드 포크

**블록 #2,675,000**

* `스퓨리어스 드래곤(Spurious Dragon)` : 더 많은 DoS 공격 벡터를 처리하고 다른 상태를 지우는 하드 포크. 또한 재생 공격 방지 메커니즘

**블록 #4,370,000**

* `메트로폴리스 비잔티움(Metropolis Byzantium)` : 메트로폴리스는 이더리움의 세 번째 단계로, 2017년 10월에 하드 포크되었으며 이 책을 저술한 시점이기도 하다. 비잔티움은 메트로폴리스를 위해 계획된 2개의 하드 포크 중 첫 번째인 것이다.

비잔티움 이후에 메트로폴리스를 위해 계획된 또 하나의 하드 포크는 콘스탄티노플이다. 메트로폴리스에 이어서 이더리움의 마지막 단계인 세레니티(Serenity)가 나올 것이다.

## **이더리움 : 범용 블록체인**

비트코인은 트랜잭션이 `상태 전이(state transition)`를 일으켜 코인의 소유권을 변경하는 탈중앙화된 합의 `상태 머신(state machine)`이라고 생각할 수 있다. 상태 전이는 여러 블록이 채굴된 후 모든 참가자가 시스템의 공통(합의) 상태로 수렴할 수 있도록 합의 규칙에 의해 제한된다.

이더리움 또한 탈중앙화 상태 머신이긴 하지만 화폐 소유 상태만 추적하는 것이 아니라 범용 데이터 저장소, 즉 `키-밸류 튜플(key-value tuple)`로 표현할 수 있는 모든 데이터를 저장할 수 있는 저장소의 상태 전이를 추적한다.

어떤 면에서는 대부분의 범용 컴퓨터에서 사용되는 `랜덤 액세스 메모리(Random Access Memory, RAM)`의 데이터 스토리지 모델과 비슷한 용도로 사용된다. 이더리움에는 코드와 데이터를 저장하는 메모리가 있으며, 이더리움은 블록체인을 사용하여 이 메모리가 시간에 따라 어떻게 변하는지를 추적한다. 범용 저장 프로그램 컴퓨터와 마찬가지로, 이더리움은 상태 머신에 코드를 로드하고 그 코드를 실행하고 그 결과 상태를 저장할 수 있다. 범용 컴퓨터 대부분과의 가장 큰 차이점은 이더리움의 상태 변화가 합의 규칙에 의해 관리되고 상태가 전체적으로 배포된 다는 것이다. 말하자면, 이더리움은 다음과 같은 질문에 대한 대답이다.

"임의의 상태를 추적하고 상태 머신을 프로그래밍하여 합의로 작동하는 월드-와이드 컴퓨터를 만들 수 있다면 어떨까요?"

## **이더리움의 구성요소**

`피어투피어 네트워크(P2P network)`

* 이더리움은 TCP 포트 3030으로 접속 가능한 `이더리움 메인 네트워크(Ethereum main network)`에서 실행되며, `ÐΞVp2p`라는 프로토콜을 실행한다.

`합의 규칙(consensus rules)`

* 이더리움의 합의 규칙은 기준 사양인 황서(Yello Paper)에 정의되어 있다.

`트랜잭션(transactions)`

* 이더리움 트랜잭션은 보낸 사람, 받는 사람, 값 및 데이터 페이로드가 포함된 네트워크 메시지이다.

`상태 머신(state machine)`

* 이더리움 상태 전이는 `바이트코드(bytedoce, 기계어 명령어)`를 실행하는 스택 기반 가상 머신인 `EVM(Ethereum Virtual Machine)`에 의해 처리된다. `스마트 컨트랙트`라는 `EVM` 프로그램은 고수준 프로그래밍 언어(ex: Solidity)로 작성되고, EVM에서 실행되도록 바이트코드로 컴파일된다.

`데이터 구조(data structures)`

* 이더리움의 상태는 트랜잭션 및 시스템 상태가 `머클 패트리샤 트리(Merkle Patricia Tree)`라고 하는 시리얼라이즈(serialize)된 해시 데이터 구조로, 각 노드의 `데이터베이스(database, 일반적으로 구글의 DB(LevelDB))`에 저장된다.

`합의 알고리즘(consensus algorithm)`

* 이더리움은 비트코인의 합의 모델인 나카모토 합의(Nakamoto Consensus)를 사용한다. 나카모토 합의는 순차 단일 서명 블록을 사용하여 작업증명(PoW)의 중요도 가중치가 가장 긴 체인(현재 상태)을 결정한다. 그러나 조만간 지분증명(PoS) 가중 투표 시스템인 코드명 `캐스퍼(Casper)`로 전환할 계획이다.

`경제적 보안성(economic security)`

* 이더리움은 현재 `이대시(Ethash)`라는 작업증명(PoW) 알고리즘을 사용하지만, 향후엔 결국 지분증명(PoS) 알고리즘을 사용할 예정이다.

`클라이언트(clients)`

* 이더리움은 클라이언트 소프트웨어를 상호운용할 수 있는 몇 가지 구현체를 갖고 있는데, 가장 유명한 것은 `게스(Go-Ethereum, Geth)`와 `패리티(Parity)`이다.
