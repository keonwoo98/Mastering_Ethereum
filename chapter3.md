# **Chapter 3. 이더리움 클라이언트**
> 본 글은 『Mastering Ethereum』을 읽고 정리한 내용입니다.

## **1. 이더리움 클라이언트**

이더리움 클라이언트는 이더리움 사양을 구현하고 다른 이더리움 클라이언트와 피어투피어 네트워크를 통해 통신하는 소프트웨어 애플리케이션이다. 기준 사양과 표준 통신 프로토콜을 준수한다면, 서로 다른 이더리움 클라이언트들끼지 `상호운용(interoperate)`이 가능하다. 이러한 서로 다른 클라이언트가 다른 탐과 다른 프로그래밍 언어로 구현되는 동안 이들은 모두 동일한 프로토콜로 `소통(speak)`하고 동일한 규칙을 따른다. 따라서 이들은 모두 동일한 이더리움 네트워크에서 운영 및 상호작용하는데 사용될 수 있다.

이더리움은 오픈 소스 프로젝트이며, 모든 주요 클라이언트의 소스 코드는 오픈 소스 라이선스(예: LGPL v3.0)하에서 사용할 수 있으므로 무료로 다운로드하여 다른 용도로 자유롭게 사용할 수 있다. 오픈 소스란 단순히 자유롭게 사용할 수 있는 것 이상을 의미한다. 또한 이더리움은 공개 기여자 커뮤니티에 의해 개발되어 누구든지 수정할 수 있다. 참여자가 많을수록 신뢰할 수 있는 코드가 된다.

이더리움은 `황서`라는 공식 사양에 의해 정의된다.

하지만 비트코인은 이와 달리 공식적인 방식으로 정의되지 않는다. 비트코인의 사양이 비트코인 코어(Core) 기준 구현체인 반면, 이더리움은 영어와 수학(공식) 사양이 결합되어 문서화되어 있다. 이 공식 사양은 다양한 이더리움 개선 제안과 함께 이더리움 클라이언트의 표준 작동 방식을 정의한다. 황서는 이더리움에 주요 변경사항이 적용됨에 따라 주기적으로 업데이트 된다.

이더리움은 각 클라이언트가 구현해야 될 사양에 대해 명확한 기준을 제시하고 있기 때문에, 독립적으로 개발된 클라이언트들도 대부분 상호운용이 가능하다. 이더리움은 다른 블록체인보다 네트워크에서 실행되는 구현의 다양성이 더 크며, 이는 일반적으로 좋은 점으로 평가된다. 실제로 이더리움은 네트워크 공격을 방어하기 위한 훌륭한 방법으로 입증되었다. 왜냐하면 특정 클라이언트의 구현 전략을 악용하는 것은 개발자가 공격을 패치하는 동안 개발자를 괴롭히지만 다른 클라이언트는 네트워크에 거의 영향을 주지 않기 때문이다.

## **2. 이더리움 네트워크**

이더리움 기반 네트워크 중에는 이더리움 `황서`에서 정의된 공식 사양에 부합하지만, 서로 간에 상호운용될 수도 있고 그렇지 않을 수도 있는 것들이 많이 있다.

이더리움 기반 네트워크는 이더리움, 이더리움 클래식(Classic), 엘라(Ella), 익스팬스(Expanse), 유비크(Ubiq), 뮤지코인(Musicoin) 및 기타 여러 네트워크가 있다. 대부분 프로토콜 수준에서 호환되는 반면, 이더리움 클라이언트 소프트웨어의 관리자가 각 네트워크를 지원하기 위해 작은 변경을 요구하는 기능 또는 속성을 갖고 있는 경우가 많다. 이 때문에 이더리움 클라이언트 소프트웨어의 모든 버전이 모든 이더리움 기반 블록체인을 실행하는 것은 아니다.

현재 여섯 가지 언어로 작성된 이더리움 프로토콜의 여섯 가지 기본 구현이 있다.

* 러스트(Rust)로 작성된 패리티(Parity)
* 고(Go)로 작성된 게스(Geth)
* C++로 작성된 cpp-ethereum
* 파이썬(Python)으로 작성된 pyethereum
* 스칼라(Scala)로 작성된 맨티스(Mantis)
* 자바(Java)로 작성된 하모니(Harmony)

이번 장에서는 가장 일반적인 2개의 클라이언트인 패리티와 게스에 대해 살펴볼 것이다. 각 클라이언트를 사용하여 노드를 설정하고 커맨드 라인(command-line) 및 애플리케이션 프로그래밍 인터페이스(Application Programming Interface, API) 중 일부를 탐색하는 방법을 학습한다.

### **2-1. 풀 노드를 실행해야 하는가?**

블록체인의 건전성(health), 복원력(resilience), 검열 저장(censorship resistance) 특성은 독립적으로 운용되고 지리적으로 분산된 풀 노드(full node)가 얼마나 많은지에 달려있다. 각각의 풀 노드는 다른 새 노드가 블록 데이터를 얻어 작업을 부트스트랩(bootstrap)하고, 운영자에게 모든 트랜잭션 및 컨트랙트에 대해 신뢰할 수 있고 독립적인 검증을 제공할 수 있도록 도와준다.

그러나 풀 노드를 실행하면 하드웨어 자원 및 대역폭 비용이 발생한다. 풀 노드는 80 ~ 100GB 정도의 데이터를 다운로드해야 하며(2018년 9월 기준이며 클라이언트에 따라 다르다), 로컬 하드 디스크에 저장해야 한다. 새로운 트랜잭션 및 블록이 추가되면서 매일 이러한 데이터 부담이 상당히 빠르게 증가한다.

이더리움 개발에는 `메인넷(mainnet)` 네트워크에서 실행 중인 풀 노드가 필요하지 않다. `테스트넷(testnet)` 노드(작은 공개 테스트 블록체인 중 하나에 연결), 가나슈(Ganache) 같은 로컬 사설 블록체인 또는 인퓨라(Infura) 같은 서비스 공급자가 제공하는 클라우드 기반 이더리움 클라이언트로 원하는 대부분의 작업을 수행할 수 있다.

블록체인의 로컬 사본을 저장하지 않거나 블록 및 트랜잭션의 유효성을 확인하지 않는 원격 클라이언트를 실행할 수도 있다. 이 클라이언트는 지갑의 기능을 제공하며 트랜잭션을 생성하고 전파할 수 있다. 원격 클라이언트를 사용하여 자신의 풀 노드, 공개 블록체인, 공개 또는 허가된(권위증명(Proof-of-Authority)) 테스트넷 또는 개인 로컬 블록체인 같은 기존 네트워크에 연결할 수 있다. 실제로 다른 모든 노드 옵션 간에 전환하기 위한 편리한 방법으로 메타마스크(MetaMask), 에메랄드 지갑(Emerald Wallet), 마이이더월렛(MyEtherWallet), 마이크립토(MyCrypto) 같은 원격 클라이언트를 사용할 것이다.

`원격 클라이언트` 및 `지갑`이라는 용어는 혼용되어 사용되기도 하지만 서로 다른 점이 있다. 일반적으로 원격 클라이언트는 지갑의 트랜잭션 기능 외에도 API(예: web3.js API)를 제공한다.

이더리움의 원격 지갑 개념을 `라이트 클라이언트`(light client, 비트코인의 간이 결제 확인(Simplified Payment Verification) 클라이언트와 유사함)의 개념과 혼동하면 안 된다. 라이트 클라이언트는 블록 헤더의 유효성을 검사하고, 머클(Merkle) 증명을 사용하여 블록체인에서의 트랜잭션 포함 여부를 확인하고 그 영향도를 결정하여 풀 노드에 대해 비슷한 수준의 보안을 제공한다. 반대로, 이더리움 원격 클라이언트는 블록 헤어 또는 트랜잭션의 유효성을 검사하지 않는다. 그들은 풀 클라이언트(full client)를 신뢰하여 블록체인에 대한 접근 권한을 부여하므로 보안 및 익명성 보장 수준이 상당히 떨어진다. 여러분 스스로 실행하는 풀 클라이언트를 사용하여 이러한 문제를 완화할 수 있다.

### **2-2. 풀 노드의 장단점**

풀 노드를 실행하기로 선택하면 네트워크를 연결하는 데 도움이 되지만, 일정 수준의 비용이 발생한다. 몇 가지 장단점을 살펴보자.

**장점**

* 이더리움 기반 네트워크의 복원력과 검열 저항을 지원한다.
* 모든 트랜잭션을 정식으로 검증한다.
* 중개자 없이 공개 블록체인의 모든 컨트랙트와 상호작용할 수 있다.
* 중개자 없이 컨트랙트를 공개 블록체인에 직접 배포할 수 있다.
* 블록체인 상태(계정, 스마트 컨트랙트 등)를 오프라인에서 조회할 수 있다(읽기 전용).
* 여러분이 읽은 정보를 제3자에게 노출하지 않고 가져올 수 있다.

**단점**

* 하드웨어와 대역폭 자원의 확대가 필요하다.
* 처음 시작할 때 전체 동기화를 위해 여러 날이 소요된다.
* 동기화를 유지하기 위해 관리하고, 업그레이드하고, 온라인 상태로 유지해야 한다.

### **2-3. 공개 테스트넷의 장단점**

풀 노드를 선택하든 아니든, 여러분은 아마도 공개 테스트넷 노드를 실행하기를 원할 것이다. 공개 테스트넷을 사용할 때의 장단점을 알아보자.

**장점**

* 테스트넷 노드는 훨씬 적은 데이터(네트워크에 따라서 약 10GB)와 동기화를 필요로 한다(2018년 4월 기준).
* 테스트넷 노드는 몇 시간 내에 전체 동기화를 할 수 있다.
* 컨트랙트 배포 및 트랜잭션 생성을 위한 테스트용 이더를 몇몇 Faucet으로부터 무료로 얻을 수 있다.
* 테스트넷은 다른 많은 스마트 컨트랙트가 동작(live) 실행 중인 공개 블록체인이다.

**단점**

* 테스트넷에서는 실제(real) 돈을 사용할 수 없다. 테스트 이더로 실행한다. 따라서 위험에 처할 만한 일이 없으므로 악의적 사용자들에 대응하는 실전 보안성 테스트를 할 수 없다.
* 테스트넷에서는 퍼블릭 블록체인에서만큼 실전 테스트를 할 수 없는 측면이 있다. 예를 들면, 테스트넷에서는 실제 트랜잭션 시 필수적으로 발생하는 비용인 가스 수수료를 고려하지 않는다. 더구나 테스트넷은 공개 메인넷에서 때때로 발생하는 네트워크 혼잡이 없다.

### **2-4. 로컬 블록체인 시뮬레이션 장단점**

많은 테스트 목적에 가장 좋은 선택은 단일 인스턴스 사설 블록체인을 실행하는 것이다. 가나슈(Ganache, 이전 이름은 testrpc)는 다른 어떤 참여자들 없이 상호작용할 수 있는 가장 인기 있는 로컬 블록체인 시뮬레이션 중 하나다. 가나슈는 공개 테스트넷의 많은 장단점을 공유하지만 약간의 차이가 있다.

**장점**

* 동기화가 없고 디스크에 데이터가 거의 없다. 직접 첫 번째 블록을 채굴한다.
* 테스트 이더를 얻을 필요가 없다. 테스트를 위해 사용할 수 있는 채굴 보상을 자신에게 수여(award)한다.
* 다른 사용자는 없고 단지 자신만 있다.
* 다른 컨트랙트는 없고 단지 자신이 시작하고 배포한 컨트랙트만 있다.

**단점**

* 다른 사용자가 없다는 건, 공개 블록체인과 동일하게 동작하지 않는다는 뜻이다. 트랜잭션 순서나 트랜잭션 공간을 두고 경쟁이 없다.
* 자신 외에 채굴자가 없다는 건, 채굴이 더욱 예측 가능하다는 뜻이다. 그러므로 공개 블록체인에서 발생하는 일부 시나리오를 테스트할 수 없다.
* 다른 컨트랙트가 없다는 건, 테스트를 위해 의존성을 갖는 것들과 컨트랙트 라이브러리를 포함하여 원하는 모든 것을 자신이 배포해야 한다는 뜻이다.
* 어떤 시나리오를 테스트하기 위한 공개 컨트랙트와 주소를 다시 만들지 못할 수도 있다(예: DAO 컨트랙트).

## **3. 이더리움 클라이언트 실행**

만약 여러분에게 시간과 자원이 있다면, 절차에 대해 좀 더 배우기 위해서라도 풀 노드의 실행을 시도해 봐야 한다. 다음 절에서는 이더리움 클라이언트인 패리티(Parity)와 게스(Geth)를 다운로드, 컴파일, 실행할 것이다. 이를 위해 운영체제에서 커맨드 라인 인터페이스를 사용하는 데 익숙해져야 한다. 테스트넷 노드로 풀 노드를 실행하는 것을 선택하든지 아니면 로컬 사설 블록체인을 위한 클라이언트를 선택하든지 간에, 이러한 클라이언트를 설치해 보는 것은 도움이 될 만한 일이다.

### **3-1. 풀 노드를 위한 하드웨어 요구사항**

시작에 앞서 이더리움 풀 노드를 실행하기 위해 컴퓨터가 충분한 자원을 갖고 있는지 확인해야 한다. 이더리움 블록체인의 전체 사본을 저장하기 위해서는 적어도 80GB의 디스크 공간이 필요하다. 만약 이더리움 테스트넷에서 풀 노드를 실행하기를 원한다면 적어도 15GB가 더 필요하다. 80GB 블록체인 데이터를 다운로드하는 데는 오랜 시간이 걸린다. 그래서 고속 인터넷에 접속하기를 권한다.

이더리움 블록체인을 동기화하는 것은 매우 많은 입출력(I/O)을 필요로 한다. 가장 좋은 방법은 솔리드 스테이트 드라이브(Solid-State Drive, SSD)를 준비하는 것이다. 만약 기계식 하드 디스크 드라이브(Hard Disk Drive, HDD)를 갖고 있다면 캐시(cache)를 사용하기 위해 적어도 8GB RAM이 필요할 것이다. 그렇지 않으면 너무 느려서 완전히 동기화되지 않을 수도 있다.

**최소 요구사항**

* 2코어 이상의 CPU
* 적어도 80GB의 여유 스토리지 공간
* 최소 4GB RAM SSD (HDD의 경우 8GB 이상)
* 다운로드 속도가 초당 8MBit인 인터넷 서비스

이것은 이더리움 기반 블록체인의 전체(하지만 정리된) 사본을 동기화하기 위한 최소 요구사항이다.

2018년 4월 시점에 패리티 코드베이스(codebase)가 리소스를 좀 더 적게 사용하기 때문에 만약 제한된 하드웨어에 실행한다면 패리티를 사용하는 것이 더 낫다.

만약 좀 더 빠른 시간 내에 동기화하고 모든 개발 도구, 라이브러리, 클라이언트 및 이 책에서 논의한 블록체인을 저장하고 싶다면, 더 고성능의 컴퓨터를 사용하는 것이 좋다.

**추천 사양**

* 4코어 이상의 빠른 CPU
* 16GB 이상의 RAM
* 메모리 여유 공간이 적어도 500GB인 빠른 SSD
* 다운로드 속도가 초당 25MBit 이상인 인터넷 서비스

블록체인의 크기가 얼마나 빨리 증가할지, 디스크 공간이 더 필요할지 예측하기가 어렵기 때문에 동기화를 시작하기 전에 블록체인의 가장 최근 데이터 용량을 확인하는 것이 좋다.

> 위에서 언급한 디스크 크기 요구사항은 오래된 상태 데이터에 대해 `분기된(pruned)` 블록체인에서 기본 설정으로 노드를 실행한다고 가정했다. 모든 상태가 디스크에 보관되는 전체 `기록(archival)` 노드를 실행한다면 1TB 이상의 디스크 공간이 필요할 수 있다.

> 다음 링크는 블록체인 크기에 대한 최신 추정치를 제공한다.  
> * [이더리움](https://bitinfocharts.com/ethereum/)
> * [이더리움 클래식](https://bit.ly/2suhljU)

### **3-2. 클라이언트(노드)를 빌드하고 실행하기 위한 소프트웨어 요구사항**

